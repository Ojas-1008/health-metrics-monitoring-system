# Server Configuration

# ============================================================================
# server/.env.example
# 
# Environment configuration for Health Metrics Monitoring System
# Copy this file to .env and populate with actual values
# 
# SECURITY WARNING: Never commit actual .env file to version control
# Add .env to .gitignore (already done in project)
# ============================================================================

# ============================================================================
# NODE ENVIRONMENT
# ============================================================================

# Runtime environment (development, staging, production)
NODE_ENV=development

# Port the Express server listens on
PORT=5000

# Server domain/URL (used in OAuth redirect URIs and CORS)
SERVER_URL=http://localhost:5000

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# MongoDB Atlas connection string
# Format: mongodb+srv://username:password@cluster.mongodb.net/database_name
# Replace with your actual MongoDB Atlas URI
# Get this from MongoDB Atlas dashboard -> Connect -> Drivers
MONGODB_URI=mongodb+srv://user:password@cluster.mongodb.net/health_metrics

# MongoDB connection retry attempts
MONGODB_RETRY_ATTEMPTS=5

# MongoDB connection retry interval (milliseconds)
MONGODB_RETRY_INTERVAL=5000

# ============================================================================
# JWT AUTHENTICATION
# ============================================================================

# Secret key for signing JWT tokens (must be cryptographically secure)
# Generate with: openssl rand -base64 32
# Minimum 32 characters, preferably 64+
JWT_SECRET=your_super_secret_jwt_key_min_32_chars_openssl_rand_base64_32

# JWT token expiration time
# Formats: "2d", "24h", "1440m", or seconds as number
JWT_EXPIRE=7d

# Refresh token expiration (for long-lived sessions)
JWT_REFRESH_EXPIRE=30d

# ============================================================================
# GOOGLE OAUTH 2.0 CONFIGURATION
# ============================================================================

# Google OAuth Client ID
# Get from: Google Cloud Console -> APIs & Services -> Credentials
# Create a new OAuth 2.0 Client ID (type: Web application)
# Copy the Client ID value here
GOOGLE_CLIENT_ID=your_google_client_id_from_console.apps.googleusercontent.com

# Google OAuth Client Secret
# From the same OAuth credentials page as Client ID
# SECURITY: Never commit this to version control
GOOGLE_CLIENT_SECRET=your_google_client_secret_from_console

# Google OAuth Redirect URI
# Must match exactly what's registered in Google Cloud Console
# Format: {SERVER_URL}/api/auth/google/callback
# During development: http://localhost:5000/api/auth/google/callback
# During production: https://yourdomain.com/api/auth/google/callback
GOOGLE_REDIRECT_URI=http://localhost:5000/api/auth/google/callback

# ============================================================================
# GOOGLE FIT API SCOPES
# ============================================================================

# Google Fit API OAuth scopes (space-separated)
# 
# ACTIVE SCOPES (Android phone data only - NO wearables):
#   • fitness.activity.read     → Steps, calories burned, active time
#   • fitness.body.read         → Weight, height measurements
#   • fitness.nutrition.read    → Calorie intake data
#   • fitness.sleep.read        → Sleep duration and quality
#   • fitness.location.read     → GPS-based distance traveled (from phone)
#
# DELIBERATELY OMITTED (wearable-exclusive):
#   ❌ fitness.heart_rate.read           → Requires smartwatch/band
#   ❌ fitness.oxygen_saturation.read    → Requires fitness band/wearable
#   ❌ fitness.blood_pressure.read       → Requires wearable monitor
#
# CONSTRAINT: This application only processes health metrics from
# the Google Fit Android app running on the user's mobile phone.
# External sensors, smartwatches, fitness bands, and other wearables
# are explicitly NOT supported to maintain data consistency.
#
# If you modify these scopes:
#   1. Update GOOGLE_FIT_OAUTH_SCOPE constant in server/models/User.js
#   2. All existing tokens become invalid (scope mismatch)
#   3. Users must re-authenticate with the new scopes
#
GOOGLE_FIT_OAUTH_SCOPES=https://www.googleapis.com/auth/fitness.activity.read https://www.googleapis.com/auth/fitness.body.read https://www.googleapis.com/auth/fitness.nutrition.read https://www.googleapis.com/auth/fitness.sleep.read https://www.googleapis.com/auth/fitness.location.read

# Google Fit API base URL (Google manages this - rarely changes)
GOOGLE_FIT_API_BASE_URL=https://www.googleapis.com/fitness/v1/users/me

# ============================================================================
# GOOGLE FIT SYNC WORKER CONFIGURATION
# ============================================================================

# CRON expression for sync worker schedule
# Determines how often the sync worker fetches data from Google Fit
# 
# Format: "minute hour day month dayOfWeek"
# Examples:
#   "*/15 * * * *"  → Every 15 minutes (4x/hour) - RECOMMENDED for live updates
#   "*/30 * * * *"  → Every 30 minutes (2x/hour) - Standard
#   "0 * * * *"     → Every hour (1x/hour) - Low frequency
#   "0 */6 * * *"   → Every 6 hours (4x/day) - Minimal syncing
#
# PERFORMANCE CONSIDERATIONS:
#   • More frequent = more real-time, but higher Google API quota usage
#   • Less frequent = lower costs, but delayed data updates
#   • Google Fit typically updates data within 5-15 minute delay
#   • Start with "*/30 * * * *" and adjust based on usage
#
SYNC_CRON_SCHEDULE=*/15 * * * *

# Maximum number of users to sync per single cron job run
# Prevents overwhelming Google Fit API quota and database
#
# Examples with SYNC_CRON_SCHEDULE="*/15 * * * *":
#   SYNC_BATCH_SIZE=50   → 50 users × 4 runs/hour × 24 hours = 4,800 syncs/day
#   SYNC_BATCH_SIZE=100  → 100 users × 4 runs/hour × 24 hours = 9,600 syncs/day
#   SYNC_BATCH_SIZE=25   → 25 users × 4 runs/hour × 24 hours = 2,400 syncs/day
#
# GOOGLE API QUOTA:
#   • Standard quota: 1,000,000 requests/day per project
#   • This typically supports 10,000-50,000 active users
#   • Adjust based on your expected user count
#   • Monitor quota usage in Google Cloud Console
#
# DATABASE PERFORMANCE:
#   • Each sync batch writes 1-10 records per user
#   • Batch size 100 = 100-1,000 writes per cron run
#   • Start low (25-50) and increase if performance permits
#
SYNC_BATCH_SIZE=50

# Timeout for individual Google Fit API calls (milliseconds)
GOOGLE_FIT_API_TIMEOUT=30000

# Maximum retries for failed sync attempts before logging error
SYNC_MAX_RETRIES=3

# Delay between retry attempts (milliseconds)
SYNC_RETRY_DELAY=5000

# Enable/disable the sync worker
# Set to false to stop syncing during maintenance
SYNC_WORKER_ENABLED=true

# ============================================================================
# FRONTEND CONFIGURATION
# ============================================================================

# Frontend domain (used for CORS and redirects)
FRONTEND_URL=http://localhost:5173

# Enable CORS for development
CORS_ENABLED=true

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Log level: error, warn, info, debug
LOG_LEVEL=debug

# Enable detailed request/response logging
LOG_HTTP_REQUESTS=true

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# Enable/disable request rate limiting
RATE_LIMIT_ENABLED=true

# Maximum requests per window per IP
RATE_LIMIT_REQUESTS=100

# Time window for rate limiting (minutes)
RATE_LIMIT_WINDOW=15

# Maximum failed login attempts before lockout
MAX_LOGIN_ATTEMPTS=5

# Account lockout duration (minutes)
LOCKOUT_DURATION=30

# ============================================================================
# EMAIL CONFIGURATION (Future: for notifications)
# ============================================================================

# SMTP server for sending notifications
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password

# From email address for automated messages
NOTIFICATIONS_FROM_EMAIL=noreply@healthmetrics.com

# ============================================================================
# APACHE SPARK CONFIGURATION (Future: for analytics)
# ============================================================================

# Spark Master URL (local, cluster, or cloud)
SPARK_MASTER=local[*]

# Spark application name
SPARK_APP_NAME=HealthMetricsAnalytics

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================

# Enable error tracking (Sentry, etc.)
SENTRY_ENABLED=false
SENTRY_DSN=your_sentry_dsn_url

# Enable performance monitoring
PERFORMANCE_MONITORING_ENABLED=true

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Enable Google Fit OAuth feature
FEATURE_GOOGLE_FIT_ENABLED=true

# Enable real-time WebSocket updates
FEATURE_REALTIME_UPDATES_ENABLED=true

# Enable predictive analytics
FEATURE_PREDICTIVE_ANALYTICS_ENABLED=false

# ============================================================================
# DEPLOYMENT INFORMATION
# ============================================================================

# Application version (semantic versioning)
APP_VERSION=1.0.0

# Build timestamp (set during deployment)
BUILD_TIMESTAMP=2025-11-05T12:00:00Z

# ============================================================================
# END OF CONFIGURATION
# ============================================================================

# Database Configuration
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/health-metrics?retryWrites=true&w=majority

# JWT Authentication
JWT_SECRET=your_super_secret_jwt_key_here_change_in_production
JWT_EXPIRE=7d

# Frontend URL (for CORS)
CLIENT_URL=http://localhost:5173

# Google OAuth (for future Google Fit integration)
GOOGLE_CLIENT_ID=your_google_client_id_here
GOOGLE_CLIENT_SECRET=your_google_client_secret_here
GOOGLE_REDIRECT_URI=http://localhost:5000/api/auth/google/callback

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
